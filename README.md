# 子比主题网盘链接批量管理插件

## 功能说明

这是一个专为子比主题（Zibll Theme）设计的WordPress插件，可以批量管理文章中的网盘下载链接。

### 主要功能

1. **批量搜索链接**
   - 按关键词搜索链接
   - 按域名筛选链接
   - 显示所有匹配的链接列表

2. **批量替换链接**
   - 在链接列表中勾选需要替换的链接
   - 使用列表上方的批量操作工具栏进行替换
   - 支持搜索替换功能，可以批量修改链接中的部分内容
   - 例如：将旧域名替换为新域名

3. **批量删除链接**
   - 在链接列表中勾选需要删除的链接
   - 使用列表上方的批量删除按钮进行操作

4. **导出链接**
   - 将当前筛选结果导出为CSV文件
   - 包含文章标题、链接地址、文章ID等信息
   - 支持Excel打开，中文显示正常

5. **导入链接**
   - 从CSV文件批量导入链接
   - 支持通过文章标题或文章ID匹配
   - 如果链接已存在，将替换原来的链接

6. **直接编辑链接**
   - 在链接列表中直接点击链接即可编辑
   - 支持实时保存，无需刷新页面
   - 支持回车保存、ESC取消

## 安装方法

1. 将插件文件夹上传到 `/wp-content/plugins/` 目录
2. 在WordPress后台的"插件"页面激活插件
3. 在"工具"菜单中找到"网盘链接管理"

## 使用方法

### 搜索链接

1. 在"搜索筛选"区域输入筛选条件：
   - **链接包含**：输入链接中的关键词（如：`lanzoul.com`）
   - **域名包含**：输入域名关键词（如：`baidu.com`）
2. 点击"搜索链接"按钮
3. 系统会显示所有匹配的链接列表

### 批量替换链接

1. 先使用搜索功能找到需要替换的链接
2. 在链接列表中勾选需要替换的链接
3. 使用列表上方的批量操作工具栏：
   - 选择替换对象（链接地址/显示名称/备注信息）
   - **查找内容**：输入要替换的内容（如：`https://old-domain.com`）
   - **替换为**：输入替换后的内容（如：`https://new-domain.com`）
   - 可选择使用正则表达式
4. 点击"批量替换"按钮
5. 系统会批量替换选中的链接

### 批量删除链接

1. 先使用搜索功能找到需要删除的链接
2. 在链接列表中勾选需要删除的链接
3. 使用列表上方的"批量删除"按钮
4. 确认删除操作
5. 系统会批量删除选中的链接

### 导出链接

1. 先使用搜索功能找到需要导出的链接（或留空导出所有链接）
2. 在"导出/导入"区域的"导出链接"部分点击"导出CSV"按钮
3. 系统会自动下载CSV文件，包含以下列：
   - **文章标题**：文章的标题
   - **链接地址**：网盘链接URL
   - **文章ID**：WordPress文章ID

### 直接编辑链接

1. 在链接列表中，直接点击任意链接地址
2. 链接会变为可编辑的输入框
3. 修改链接后，点击"保存"按钮或按回车键保存
4. 点击"取消"按钮或按ESC键取消编辑
5. 保存成功后，链接会立即更新

### 导入链接

1. 准备CSV文件，格式如下：
   ```
   文章标题,链接地址,文章ID
   示例文章1,https://example.com/link1,123
   示例文章2,https://example.com/link2,
   示例文章3,https://pan.baidu.com/s/1abc123?pwd=8888,
   示例文章4,https://pan.quark.cn/s/abc123def456?pwd=8888,
   ```
   - 第一行为标题行（必须）
   - 文章ID列可选，如果提供将直接更新该文章
   - 如果不提供文章ID，系统会通过文章标题匹配

2. 在"导出/导入"区域的"导入链接"部分：
   - 点击"选择文件"按钮，选择CSV文件
   - 点击"导入CSV"按钮
   - 确认导入操作

3. 系统会显示导入结果：
   - 成功导入/替换的链接数量
   - 更新的文章数量
   - 跳过的记录（格式错误）
   - 错误信息（如果有）

**导入说明：**
- 如果文章不存在pay_mate数据，系统会自动创建并设置为付费下载类型
- 如果链接已存在，将替换原来的链接
- 导入的链接会添加到文章的下载资源列表中

## 注意事项

1. **备份数据**：在执行批量替换、删除或导入操作前，建议先备份数据库
2. **权限要求**：只有管理员（manage_options权限）才能使用此插件
3. **操作不可逆**：删除操作不可恢复，请谨慎操作
4. **兼容性**：支持子比主题新旧版本的资源链接格式
5. **CSV格式**：导入的CSV文件必须使用UTF-8编码，建议使用Excel或文本编辑器保存为CSV格式
6. **文章匹配**：导入时如果通过标题匹配，标题必须完全一致（区分大小写）

## 技术说明

- 插件读取 `posts_zibpay` post meta 中的 `pay_download` 字段
- 支持新版数组格式和旧版字符串格式
- 使用AJAX异步处理，不会阻塞页面

## 版本信息

- 版本：1.3.0
- 兼容WordPress：5.0+
- 兼容子比主题：8.1+

## 更新日志

### 1.3.0 (2025-12-08)
- **新增**：操作日志功能，记录所有修改、替换和删除操作
- **新增**：分页功能，支持自定义每页显示条数（10-200条）
- **新增**：批量操作支持正则表达式匹配
- **新增**：支持批量修改“显示名称”和“备注信息”字段
- **优化**：重构数据库查询，支持数万级数据秒开
- **优化**：增加自动日志清理和卸载清理机制

### 1.2.1 (2025-12-08)
- 性能优化：重构查询逻辑，使用 SQL JOIN 替代 N+1 查询，显著提升大量数据时的加载速度
- 性能优化：搜索时增加数据库层面的预过滤，减少内存占用
- 性能优化：导入链接时批量获取文章 ID，大幅减少数据库查询次数
- 安全优化：增加查询结果数量限制，防止内存溢出

### 1.2.0 (2024-12-XX)
- 新增直接编辑功能：在链接列表中点击链接即可直接编辑
- 支持实时保存，无需刷新页面
- 支持回车保存、ESC取消快捷键
- 更新示例文件，添加夸克网盘链接示例

### 1.1.0 (2024-12-XX)
- 新增导出功能：支持将链接导出为CSV文件
- 新增导入功能：支持从CSV文件批量导入链接
- 优化文章匹配逻辑，提高导入准确性

### 1.0.0 (2024-12-XX)
- 初始版本发布
- 支持批量搜索、替换、删除链接

## 支持

如有问题或建议，请联系网站管理员。

